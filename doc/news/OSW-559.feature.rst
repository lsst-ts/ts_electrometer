Improved retry loop by reconnecting if disconnected for whatever reason.